<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>택시 요금 계산기_by 으흣쨔</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #121212; /* 기본 배경색 */
            color: #ffffff;
        }
        .counter {
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(255,255,255,0.1);
            text-align: center;
            width: 320px;
        }
        h2 {
            color: #ffffff;
            margin-bottom: 10px;
            font-size: 24px;
        }
        .input-container {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-bottom: 10px;
        }
        .input-container label {
            margin-bottom: 2px;
            font-size: 14px;
        }
        .input-container input {
            width: 100%;
            padding: 8px;
            margin: 2px 0;
            border: 2px solid #333;
            border-radius: 6px;
            font-size: 16px;
            background-color: #2c2c2c;
            color: #ffffff;
        }
        .checkbox-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 10px 0;
            font-size: 14px;
        }
        .checkbox-container input[type="checkbox"] {
            margin-right: 5px;
            transform: scale(1.2);
        }
        .checkbox-container input[type="number"] {
            width: 50px;
            padding: 3px;
            margin-left: 5px;
        }
        .amount-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
        }
        .amount-display {
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }
        #horseGif {
            width: 40px;
            height: 40px;
            margin-right: 10px;
            display: none;
            object-fit: contain;
            background-color: transparent;
        }
        #amount {
            font-size: 28px;
            font-weight: bold;
            color: #f09035;
            margin-bottom: -10px; /* 아래쪽 마진을 제거하여 공백을 줄임 */
        }
        #rateInfo {
            font-size: 14px;
            color: #cccccc;
            margin-top: 5px;
        }
        .multiplier-info {
            font-size: 14px;  /* 남성 전용과 같은 크기 */
            color: #cccccc;
            margin-top: 0px;
            display: block;  /* 배수가 계산된 값 아래에 표시되도록 변경 */
        }
        .button-container {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }
        .compact-button {
            background-color: #121212; /* 기본 배경색 */
            padding: 6px;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.3s;
            flex-grow: 1;
            margin: 0 2px;
        }

        /* 클릭된 상태에서 배경색을 원래 색상으로 변경 */
        .clicked-start {
            background-color: #4CAF50; /* 시작 버튼 원래 색상 */
        }
        .clicked-stop {
            background-color: #FF5722; /* 멈춤 버튼 원래 색상 */
        }
        .clicked-pay {
            background-color: #2196F3; /* 지불 버튼 원래 색상 */
        }
        .clicked-discount {
            background-color: #FF9800; /* 할인 버튼 원래 색상 */
        }
        .clicked-surcharge {
            background-color: #f44336; /* 할증 버튼 원래 색상 */
        }
        .clicked-male {
            background-color: #00BCD4; /* 남성 버튼 원래 색상 */
        }
        .clicked-random {
            background-color: #9C27B0; /* 랜덤 버튼 원래 색상 */
        }
        #paymentHistory {
            margin-top: 10px;
            text-align: left;
            font-size: 12px;
            max-height: 100px;
            overflow-y: auto;
        }
        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .delete-history {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 2px 5px;
            cursor: pointer;
            font-size: 10px;
        }
        #totalAmount {
            margin-top: 0px;
            font-weight: bold;
            font-size: 12px;
        }
        #serviceFee {
            margin-top: 0px;
            font-size: 12px;
            color: #f09035;
        }
        #clearHistoryBtn {
            background-color: #607D8B;
            margin-top: 5px;
        }
        #clearHistoryBtn:hover {
            background-color: #455A64;
        }
    </style>
</head>
<body>
    <div class="counter">
        <h2>택시 요금 계산기_by으흣쨔</h2>
        <div class="input-container">
            <label for="startingFare">기본 요금 (원)_1분후 초당요금 적용</label>
            <input type="number" id="startingFare" value="3000" min="0" onchange="updateRate()">
        </div>
        <div class="input-container">
            <label for="perSecond">초당 요금 (원/초)</label>
            <input type="number" id="perSecond" value="100" min="0" onchange="updateRate()">
        </div>
        <div class="checkbox-container">
            <div>
                <input type="checkbox" id="discount" onclick="toggleOption('discount', 'clicked-discount')">
                <label for="discount">할인 적용(배수)_리뷰, 인스타</label>
            </div>
            <div style="display: flex; align-items: center;">
                <input type="number" id="discountRate" value="0.5" min="0" max="1" step="0.1" onchange="updateRate()">
                <button class="reset-option" onclick="resetOption('discount', 0.5)">초기화</button>
            </div>
        </div>
        <div class="checkbox-container">
            <div>
                <input type="checkbox" id="surcharge" onclick="toggleOption('surcharge', 'clicked-surcharge')">
                <label for="surcharge">할증 적용(배수)</label>
            </div>
            <div style="display: flex; align-items: center;">
                <input type="number" id="surchargeRate" value="1.5" min="1" step="0.1" onchange="updateRate()">
                <button class="reset-option" onclick="resetOption('surcharge', 1.5)">초기화</button>
            </div>
        </div>
        <div class="checkbox-container">
            <div>
                <input type="checkbox" id="maleOnly" onclick="toggleOption('maleOnly', 'clicked-male')">
                <label for="maleOnly">추 전용(배수)</label>
            </div>
            <div style="display: flex; align-items: center;">
                <input type="number" id="maleOnlyRate" value="2" min="1" step="0.1" onchange="updateRate()">
                <button class="reset-option" onclick="resetOption('maleOnly', 2)">초기화</button>
            </div>
        </div>
        <div class="checkbox-container">
            <div>
                <input type="checkbox" id="randomProbabilityControl" onclick="toggleOption('randomProbabilityControl', 'clicked-random')">
                <label for="randomProbabilityControl">랜덤 확률 조작 (%)</label>
            </div>
            <div style="display: flex; align-items: center;">
                <input type="number" id="randomProbability" value="50" min="0" max="100" step="1" onchange="updateRate()">
                <button class="reset-option" onclick="resetOption('randomProbability', 50)">초기화</button>
            </div>
        </div>
        <div class="input-container">
            <label for="serviceFeeRate">춘식택시 요금 계산기 사용 수수료 비율 (%)</label>
            <input type="number" id="serviceFeeRate" value="5" min="0" max="100" step="1" onchange="updateRate()">
        </div>
        <div class="amount-container">
            <div class="amount-display">
                <img id="horseGif" src="https://i.ibb.co/xhSrG0L/horse.gif" alt="달리는 말" onerror="this.onerror=null; this.src='https://via.placeholder.com/40'; this.alt='이미지 로드 실패';">
                <div id="amount">3000 원</div>
            </div>
            <div id="rateInfo"></div>
            <!-- 배수 정보 추가 -->
            <div id="multiplierInfo" class="multiplier-info">(현재 1배 적용)</div>
        </div>
        <div class="button-container">
            <button id="startBtn" class="compact-button" onclick="toggleButtonClick('startBtn', 'clicked-start'); startCounter()">시작</button>
            <button id="stopBtn" class="compact-button" onclick="toggleButtonClick('stopBtn', 'clicked-stop'); stopCounter()" disabled>멈춤</button>
            <button id="payBtn" class="compact-button" onclick="toggleButtonClick('payBtn', 'clicked-pay'); payAndResetColors()">지불</button>
            <button id="discountBtn" class="compact-button" onclick="toggleButtonClick('discountBtn', 'clicked-discount'); toggleOption('discount')">할인</button>
            <button id="surchargeBtn" class="compact-button" onclick="toggleButtonClick('surchargeBtn', 'clicked-surcharge'); toggleOption('surcharge')">할증</button>
            <button id="maleBtn" class="compact-button" onclick="toggleButtonClick('maleBtn', 'clicked-male'); toggleOption('maleOnly')">추</button>
            <button id="randomBtn" class="compact-button" onclick="toggleButtonClick('randomBtn', 'clicked-random'); applyRandomRate()">랜덤</button>
        </div>
        <div id="totalAmount">총 합계: 0 원</div>
        <div id="serviceFee">춘식택시 요금 계산기 사용 수수료: 0 원</div>
        <div id="paymentHistory"></div>
        <button id="clearHistoryBtn" class="compact-button" onclick="clearHistory()">기록 삭제</button>
    </div>

    <script>
        let amount = 3000;
        let startingFare = 3000;
        let perSecond = 100;
        let intervalId = null;
        let surchargeRate = 1;
        let discountRate = 1;
        let maleOnlyRate = 1;
        let randomRate = 1;
        let randomProbability = 50;  // 기본값을 50%로 설정
        let serviceFeeRate = 5; // 수수료 기본값 5%
        let startTime = 0;
        let totalAmount = 0;
        const horseGif = document.getElementById('horseGif');

        function updateRate() {
            startingFare = parseFloat(document.getElementById('startingFare').value);
            perSecond = parseFloat(document.getElementById('perSecond').value);
            surchargeRate = document.getElementById('surcharge').checked ? 
                parseFloat(document.getElementById('surchargeRate').value) : 1;
            discountRate = document.getElementById('discount').checked ? 
                parseFloat(document.getElementById('discountRate').value) : 1;
            maleOnlyRate = document.getElementById('maleOnly').checked ? 
                parseFloat(document.getElementById('maleOnlyRate').value) : 1;
            randomProbability = parseFloat(document.getElementById('randomProbability').value);  // 사용자 지정 확률
            serviceFeeRate = parseFloat(document.getElementById('serviceFeeRate').value); // 수수료 비율 설정
            
            amount = startingFare * surchargeRate * discountRate * maleOnlyRate * randomRate;
            const totalMultiplier = surchargeRate * discountRate * maleOnlyRate * randomRate;
            
            // 배수 정보 업데이트 (소수점 첫째자리까지만 표시)
            document.getElementById('multiplierInfo').textContent = `(현재 ${totalMultiplier.toFixed(1)}배 적용)`;
            
            if (intervalId) {
                stopCounter();
                startCounter();
            }
            updateAmountDisplay();
        }

        function applyRandomRate() {
            const rand = Math.random() * 100;  // 0 ~ 100 사이의 값 생성
            if (rand <= randomProbability) {
                // 설정된 확률로 1.1x ~ 2.0x 사이 배수 적용
                randomRate = (Math.random() * (2.0 - 1.1) + 1.1).toFixed(1);
            } else {
                // 나머지 확률로 0.5x ~ 1.1x 사이 배수 적용
                randomRate = (Math.random() * (1.1 - 0.5) + 0.5).toFixed(1);
            }
            updateRate();
        }

        function startCounter() {
            if (intervalId) return;
            if (isNaN(startingFare) || startingFare < 0 || isNaN(perSecond) || perSecond < 0) {
                alert('유효한 기본 요금과 초당 금액을 입력해주세요.');
                return;
            }
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('payBtn').disabled = true;
            horseGif.style.display = 'block';
            startTime = Date.now();
            intervalId = setInterval(() => {
                const elapsedTime = (Date.now() - startTime) / 1000;
                if (elapsedTime > 60) {
                    amount += (perSecond * surchargeRate * discountRate * maleOnlyRate * randomRate) / 10;
                }
                updateAmountDisplay();
            }, 100);
        }

        function stopCounter() {
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = null;
                document.getElementById('startBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
                document.getElementById('payBtn').disabled = false;
                horseGif.style.display = 'none';
            }
        }

        function pay() {
            const now = new Date();
            const paymentTime = now.toLocaleString();
            const paymentAmount = Math.floor(amount);
            const historyEntry = `${paymentTime}: ${paymentAmount.toLocaleString()} 원`;
            addHistoryItem(historyEntry, paymentAmount);
            
            totalAmount += paymentAmount;
            document.getElementById('totalAmount').textContent = `총 합계: ${totalAmount.toLocaleString()} 원`;
            
            // 수수료 계산
            const serviceFee = Math.floor(totalAmount * (serviceFeeRate / 100));
            document.getElementById('serviceFee').textContent = `춘식택시 요금 계산기 사용 수수료: ${serviceFee.toLocaleString()} 원`;
            
            resetCounter();
        }

        // 지불 후 모든 버튼의 색상 기본으로 복원 및 배수 1로 초기화
        function payAndResetColors() {
            pay();
            resetButtonColors();
            resetMultiplier();
        }

        // 모든 버튼 색상 기본으로 돌리기
        function resetButtonColors() {
            const buttons = document.querySelectorAll('.compact-button');
            buttons.forEach(button => {
                button.className = 'compact-button'; // 기본 클래스로 설정
            });
        }

        // 배수 정보를 1배로 초기화하는 함수
        function resetMultiplier() {
            document.getElementById('multiplierInfo').textContent = "(현재 1배 적용)";
            randomRate = 1;
            updateAmountDisplay();
        }

        function addHistoryItem(text, amount) {
            const historyDiv = document.createElement('div');
            historyDiv.className = 'history-item';
            historyDiv.innerHTML = `
                <span>${text}</span>
                <button class="delete-history" onclick="deleteHistoryItem(this, ${amount})">삭제</button>
            `;
            document.getElementById('paymentHistory').appendChild(historyDiv);
        }

        function deleteHistoryItem(button, amount) {
            const historyItem = button.parentElement;
            historyItem.remove();
            totalAmount -= amount;
            document.getElementById('totalAmount').textContent = `총 합계: ${totalAmount.toLocaleString()} 원`;
            
            // 수수료 재계산
            const serviceFee = Math.floor(totalAmount * (serviceFeeRate / 100));
            document.getElementById('serviceFee').textContent = `춘식택시 요금 계산기 사용 수수료: ${serviceFee.toLocaleString()} 원`;
        }

        function resetCounter() {
            amount = startingFare;
            startTime = 0;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('payBtn').disabled = false;
            horseGif.style.display = 'none';

            document.getElementById('discount').checked = false;
            document.getElementById('surcharge').checked = false;
            document.getElementById('maleOnly').checked = false;
            document.getElementById('randomProbabilityControl').checked = false;
            surchargeRate = 1;
            discountRate = 1;
            maleOnlyRate = 1;
            randomRate = 1;
            randomProbability = 50;  // 초기화 시 기본값 50%

            updateAmountDisplay();
        }

        function toggleOption(option, clickedClass) {
            const checkbox = document.getElementById(option);
            checkbox.checked = !checkbox.checked;
            const button = document.getElementById(option + 'Btn');
            if (button) {
                button.classList.toggle(clickedClass, checkbox.checked);
            }
            updateRate();
        }

        function toggleButtonClick(buttonId, clickedClass) {
            const button = document.getElementById(buttonId);
            button.classList.toggle(clickedClass);
        }

        function resetOption(option, defaultValue) {
            if (option === 'startingFare' || option === 'perSecond') {
                document.getElementById(option).value = defaultValue;
            } else {
                document.getElementById(option).checked = false;
                document.getElementById(option + 'Rate').value = defaultValue;
            }
            updateRate();
        }

        function clearHistory() {
            document.getElementById('paymentHistory').innerHTML = '';
            totalAmount = 0;
            document.getElementById('totalAmount').textContent = '총 합계: 0 원';
            document.getElementById('serviceFee').textContent = '춘식택시 요금 계산기 사용 수수료: 0 원';
        }

        function updateAmountDisplay() {
            document.getElementById('amount').textContent = `${Math.floor(amount).toLocaleString()} 원`;
        }
    </script>
</body>
</html>
